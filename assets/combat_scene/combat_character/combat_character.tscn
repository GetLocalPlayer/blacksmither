[gd_scene load_steps=63 format=3 uid="uid://0aiqln2jekco"]

[ext_resource type="Script" path="res://assets/combat_scene/combat_character/combat_character.gd" id="1_uyb1w"]
[ext_resource type="Script" path="res://assets/combat_scene/combat_character/animation_tree.gd" id="2_8pfwx"]
[ext_resource type="Script" path="res://assets/combat_scene/combat_character/fsm.gd" id="2_26k2l"]
[ext_resource type="PackedScene" uid="uid://b6f7wde0eg2p3" path="res://models/characters/emma/emma.tscn" id="2_n31pi"]
[ext_resource type="Texture2D" uid="uid://d1aiyafo1810t" path="res://textures/icon_attack.png" id="4_j3ua5"]
[ext_resource type="Script" path="res://assets/combat_scene/combat_character/combat_ability.gd" id="7_lr64r"]

[sub_resource type="CylinderShape3D" id="CylinderShape3D_ehpfb"]
height = 1.748
radius = 0.777853

[sub_resource type="CylinderShape3D" id="CylinderShape3D_byb5w"]
height = 1.748
radius = 0.345411

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_bwewy"]
animation = &"kick"
use_custom_timeline = true
timeline_length = 1.0
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_rceyi"]
animation = &"death"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_dert3"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_dlnud"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_wyfb4"]
animation = &"idle_injured"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ttqj4"]
animation = &"idle_injured"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_b3jlg"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_byocn"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "health/max_health >= 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_idkm1"]
advance_mode = 2
advance_expression = "not is_dead() and health/max_health >= 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_5u6rk"]
advance_mode = 2
advance_expression = "not is_dead() and health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ne7xm"]
xfade_time = 0.25
break_loop_at_end = true
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_f26e5"]
xfade_time = 0.25
break_loop_at_end = true
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_oet6m"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7i5px"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "health/max_health >= 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_nhi6j"]
xfade_time = 0.5
break_loop_at_end = true
switch_mode = 2
advance_mode = 2
advance_expression = "health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7yk2k"]
xfade_time = 0.5
break_loop_at_end = true
switch_mode = 2
advance_mode = 2
advance_expression = "health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_kru47"]
xfade_time = 0.1
break_loop_at_end = true
advance_mode = 2
advance_expression = "is_dead()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_4wsmp"]
xfade_time = 0.1
break_loop_at_end = true
advance_mode = 2
advance_expression = "is_dead()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_fpl1v"]
xfade_time = 0.1
break_loop_at_end = true
advance_mode = 2
advance_expression = "is_dead()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ny7o4"]
xfade_time = 0.1
break_loop_at_end = true
advance_mode = 2
advance_expression = "is_dead()"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_0adng"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not is_dead() and health/max_health >= 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_16pms"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not is_dead() and health/max_health >= 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_3qwgn"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not is_dead() and health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_n8vxf"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "not is_dead() and health/max_health < 0.5"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_1uhhq"]
advance_mode = 2
advance_expression = "is_dead()"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_fcgxo"]
states/End/position = Vector2(972, 46)
states/Start/position = Vector2(248, 18)
states/death/node = SubResource("AnimationNodeAnimation_rceyi")
states/death/position = Vector2(629, -1)
states/idle/node = SubResource("AnimationNodeAnimation_dlnud")
states/idle/position = Vector2(503, -103)
"states/idle 2/node" = SubResource("AnimationNodeAnimation_dert3")
"states/idle 2/position" = Vector2(748, -123)
states/idle_injured/node = SubResource("AnimationNodeAnimation_ttqj4")
states/idle_injured/position = Vector2(503, 138)
"states/idle_injured 2/node" = SubResource("AnimationNodeAnimation_wyfb4")
"states/idle_injured 2/position" = Vector2(736, 133)
transitions = ["idle", "idle_injured", SubResource("AnimationNodeStateMachineTransition_b3jlg"), "idle_injured", "idle", SubResource("AnimationNodeStateMachineTransition_byocn"), "Start", "idle", SubResource("AnimationNodeStateMachineTransition_idkm1"), "Start", "idle_injured", SubResource("AnimationNodeStateMachineTransition_5u6rk"), "idle", "idle 2", SubResource("AnimationNodeStateMachineTransition_ne7xm"), "idle 2", "idle", SubResource("AnimationNodeStateMachineTransition_f26e5"), "idle 2", "idle_injured 2", SubResource("AnimationNodeStateMachineTransition_oet6m"), "idle_injured 2", "idle 2", SubResource("AnimationNodeStateMachineTransition_7i5px"), "idle_injured", "idle_injured 2", SubResource("AnimationNodeStateMachineTransition_nhi6j"), "idle_injured 2", "idle_injured", SubResource("AnimationNodeStateMachineTransition_7yk2k"), "idle", "death", SubResource("AnimationNodeStateMachineTransition_kru47"), "idle 2", "death", SubResource("AnimationNodeStateMachineTransition_4wsmp"), "idle_injured 2", "death", SubResource("AnimationNodeStateMachineTransition_fpl1v"), "idle_injured", "death", SubResource("AnimationNodeStateMachineTransition_ny7o4"), "death", "idle 2", SubResource("AnimationNodeStateMachineTransition_0adng"), "death", "idle", SubResource("AnimationNodeStateMachineTransition_16pms"), "death", "idle_injured", SubResource("AnimationNodeStateMachineTransition_3qwgn"), "death", "idle_injured 2", SubResource("AnimationNodeStateMachineTransition_n8vxf"), "Start", "death", SubResource("AnimationNodeStateMachineTransition_1uhhq")]
graph_offset = Vector2(77, -183)

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_0wbf6"]
animation = &"idle_kick"
use_custom_timeline = true
timeline_length = 1.82
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_jenda"]
animation = &"idle_kick"
use_custom_timeline = true
timeline_length = 1.835
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_07ayi"]
animation = &"prep_kick"
use_custom_timeline = true
timeline_length = 1.0
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_bubyg"]
xfade_time = 0.4
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_vbtdt"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_x3gsb"]
xfade_time = 0.4
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_e02iu"]
xfade_time = 0.4
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_bdtj5"]
states/Start/position = Vector2(230, 94)
states/idle_kick/node = SubResource("AnimationNodeAnimation_jenda")
states/idle_kick/position = Vector2(578, 88)
"states/idle_kick 2/node" = SubResource("AnimationNodeAnimation_0wbf6")
"states/idle_kick 2/position" = Vector2(578, 196)
states/prep_kick/node = SubResource("AnimationNodeAnimation_07ayi")
states/prep_kick/position = Vector2(373, 94)
transitions = ["prep_kick", "idle_kick", SubResource("AnimationNodeStateMachineTransition_bubyg"), "Start", "prep_kick", SubResource("AnimationNodeStateMachineTransition_vbtdt"), "idle_kick", "idle_kick 2", SubResource("AnimationNodeStateMachineTransition_x3gsb"), "idle_kick 2", "idle_kick", SubResource("AnimationNodeStateMachineTransition_e02iu")]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_6ff48"]
animation = &"fall"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_5fb7x"]
animation = &"run"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_85be4"]
animation = &"damaged_impact"
use_custom_timeline = true
timeline_length = 1.0
stretch_time_scale = true
start_offset = 0.0
loop_mode = 0

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_2pu3j"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_dt4mf"]
xfade_time = 0.2
switch_mode = 2
advance_mode = 2
advance_condition = &"state_idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_7pnh5"]
xfade_time = 0.2
advance_mode = 2
advance_expression = "selected_ability and selected_ability.name == \"Attack\""

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_waxeq"]
xfade_time = 0.3
advance_mode = 2
advance_expression = "not selected_ability"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_lwrot"]
xfade_time = 0.3
advance_mode = 2
advance_condition = &"state_approach_target"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_acs08"]
xfade_time = 0.2
advance_mode = 2
advance_condition = &"ability_Attack"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_wejc2"]
xfade_time = 0.4
advance_mode = 2
advance_condition = &"state_retreat"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_gb1r3"]
xfade_time = 0.1
advance_mode = 2
advance_condition = &"state_idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_kcwxh"]
xfade_time = 0.1
advance_mode = 2
advance_condition = &"state_retreat"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_epk6k"]
xfade_time = 0.5
advance_mode = 2
advance_condition = &"state_idle"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_byls5"]
xfade_time = 0.1
advance_mode = 2
advance_condition = &"state_take_damage"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_s0cpy"]
advance_mode = 2
advance_condition = &"state_idle"

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_b075f"]
states/End/position = Vector2(969, 102)
states/Start/position = Vector2(25, 131)
states/attack/node = SubResource("AnimationNodeAnimation_bwewy")
states/attack/position = Vector2(776, -177)
states/idle/node = SubResource("AnimationNodeStateMachine_fcgxo")
states/idle/position = Vector2(353, 54)
states/prepare_attack/node = SubResource("AnimationNodeStateMachine_bdtj5")
states/prepare_attack/position = Vector2(340, -211)
states/retreat/node = SubResource("AnimationNodeAnimation_6ff48")
states/retreat/position = Vector2(598, 120)
states/run/node = SubResource("AnimationNodeAnimation_5fb7x")
states/run/position = Vector2(660, -257)
states/take_damage/node = SubResource("AnimationNodeAnimation_85be4")
states/take_damage/position = Vector2(179, -49)
transitions = ["Start", "idle", SubResource("AnimationNodeStateMachineTransition_2pu3j"), "attack", "idle", SubResource("AnimationNodeStateMachineTransition_dt4mf"), "idle", "prepare_attack", SubResource("AnimationNodeStateMachineTransition_7pnh5"), "prepare_attack", "idle", SubResource("AnimationNodeStateMachineTransition_waxeq"), "prepare_attack", "run", SubResource("AnimationNodeStateMachineTransition_lwrot"), "run", "attack", SubResource("AnimationNodeStateMachineTransition_acs08"), "attack", "retreat", SubResource("AnimationNodeStateMachineTransition_wejc2"), "retreat", "idle", SubResource("AnimationNodeStateMachineTransition_gb1r3"), "idle", "retreat", SubResource("AnimationNodeStateMachineTransition_kcwxh"), "take_damage", "idle", SubResource("AnimationNodeStateMachineTransition_epk6k"), "idle", "take_damage", SubResource("AnimationNodeStateMachineTransition_byls5"), "run", "idle", SubResource("AnimationNodeStateMachineTransition_s0cpy")]
graph_offset = Vector2(-5, -214.063)

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_5jnvj"]
bg_color = Color(0, 0, 0, 1)
skew = Vector2(0.22, 0)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color(0.8, 0, 0, 1)
border_blend = true

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_h4mbc"]
bg_color = Color(0, 0.654902, 0, 1)
skew = Vector2(0.22, 0)
border_width_left = 2
border_width_top = 2
border_width_right = 2
border_width_bottom = 2
border_color = Color(0.8, 0, 0, 1)
border_blend = true

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_78gh5"]
bg_color = Color(0.6, 0.6, 0.6, 0)
border_width_left = 5
border_width_top = 8
border_width_right = 5
border_color = Color(0, 0.356863, 0.8, 1)
corner_radius_top_left = 13
corner_radius_top_right = 13
corner_radius_bottom_right = 425
corner_radius_bottom_left = 425

[sub_resource type="StyleBoxFlat" id="StyleBoxFlat_0arcv"]
bg_color = Color(1, 0.6, 0.6, 1)
corner_radius_top_left = 8
corner_radius_top_right = 8
corner_radius_bottom_right = 8
corner_radius_bottom_left = 8

[node name="CombatCharacter" type="Node3D"]
script = ExtResource("1_uyb1w")
move_speed = 8.0

[node name="CharacterDetector" type="Area3D" parent="."]
input_ray_pickable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="CharacterDetector"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0510902, 0.889888, -0.140369)
shape = SubResource("CylinderShape3D_ehpfb")

[node name="MouseDetector" type="Area3D" parent="."]
collision_mask = 0

[node name="CollisionShape3D" type="CollisionShape3D" parent="MouseDetector"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0510902, 0.889888, -0.140369)
shape = SubResource("CylinderShape3D_byb5w")

[node name="AnimationTree" type="AnimationTree" parent="."]
root_node = NodePath("../Model")
tree_root = SubResource("AnimationNodeStateMachine_b075f")
advance_expression_base_node = NodePath("..")
anim_player = NodePath("../Model/AnimationPlayer")
parameters/conditions/ability_Attack = false
parameters/conditions/state_approach_target = false
parameters/conditions/state_idle = false
parameters/conditions/state_retreat = false
parameters/conditions/state_take_damage = false
script = ExtResource("2_8pfwx")

[node name="Model" parent="." instance=ExtResource("2_n31pi")]

[node name="FSM" type="Node" parent="."]
script = ExtResource("2_26k2l")

[node name="Abilities" type="Node" parent="."]

[node name="Attack" type="Node" parent="Abilities"]
script = ExtResource("7_lr64r")
icon = ExtResource("4_j3ua5")
effect_value = 30.0

[node name="HealthBar" type="ProgressBar" parent="."]
offset_left = -50.0
offset_top = -12.0
offset_right = 30.0
offset_bottom = 3.0
pivot_offset = Vector2(40, -12)
size_flags_horizontal = 0
theme_override_constants/outline_size = 2
theme_override_font_sizes/font_size = 9
theme_override_styles/background = SubResource("StyleBoxFlat_5jnvj")
theme_override_styles/fill = SubResource("StyleBoxFlat_h4mbc")
max_value = 1.0
step = 0.001
value = 0.41
allow_greater = true
allow_lesser = true
show_percentage = false

[node name="Selected" type="Panel" parent="HealthBar"]
z_index = -1
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -11.0
offset_top = -11.0
offset_right = 12.0
offset_bottom = -5.0
grow_horizontal = 2
grow_vertical = 2
theme_override_styles/panel = SubResource("StyleBoxFlat_78gh5")

[node name="TargetMarks" type="Control" parent="HealthBar"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Primary" type="Panel" parent="HealthBar/TargetMarks"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -7.0
offset_top = 22.24
offset_right = 7.0
offset_bottom = 51.24
grow_horizontal = 2
pivot_offset = Vector2(0, 13.5)
theme_override_styles/panel = SubResource("StyleBoxFlat_0arcv")

[node name="Secondary" type="Panel" parent="HealthBar/TargetMarks"]
layout_mode = 1
anchors_preset = 5
anchor_left = 0.5
anchor_right = 0.5
offset_left = -7.0
offset_top = 22.0
offset_right = 7.0
offset_bottom = 35.0
grow_horizontal = 2
pivot_offset = Vector2(0, 13.5)
theme_override_styles/panel = SubResource("StyleBoxFlat_0arcv")
